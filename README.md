# infra-smoke-postgres

PostgreSQL database for smoke tests

**Generated by GX Genesis | Team: team3 | Tier: infra | Workload: infra**

## ğŸ—ï¸ **Infrastructure Service**

This is an infrastructure-level service providing foundational capabilities for the Galaxy ecosystem.

## ğŸš€ **Quick Start**

### **Development**
```bash
# Build the infrastructure service
docker build -t infra-smoke-postgres .

# Run locally with data persistence
docker run -d \
  --name infra-smoke-postgres \
  -p 8545:8545 \
  -v infra-smoke-postgres_data:/app/data \
  infra-smoke-postgres
```

### **Production Deployment**
```bash
# Deploy with Helm
helm install infra-smoke-postgres ./helm

# Deploy to specific environment
helm install infra-smoke-postgres ./helm -f helm/env/prod.values.yaml
```

## ğŸ“Š **Service Configuration**

### **DNS Domains**
This service is configured with the following domains:
{{#DNS_DOMAINS}}
- `{{.}}.environment.galaxy.com`
{{/DNS_DOMAINS}}

### **Ports**
- **API Port**: 8545 (Infrastructure services)
- **Health Check**: `/health` endpoint
- **Metrics**: `/metrics` endpoint (if enabled)

### **Persistent Storage**
- **Data Directory**: `/app/data`
- **Storage Size**: 20Gi (configurable)
- **Access Mode**: ReadWriteOnce

## ğŸ› ï¸ **Infrastructure Features**

- **ğŸ”’ Security**: Non-root user (`infrauser`)
- **ğŸ’¾ Persistence**: Automatic data volume mounting
- **ğŸ“ˆ Monitoring**: Extended health check intervals for infrastructure workloads
- **âš–ï¸ Resources**: Higher memory/CPU allocations for infrastructure needs
- **ğŸ·ï¸ Anti-Affinity**: Spread replicas across different nodes for resilience

## âš™ï¸ **Configuration**

### **Environment Variables**
- `SERVICE_NAME`: infra-smoke-postgres
- `SERVICE_TIER`: infra
- `SERVICE_TEAM`: team3
- `INFRASTRUCTURE_MODE`: enabled

### **Helm Values**
Base configuration is in `helm/values.yaml`. Environment-specific overrides:

- `helm/env/local.values.yaml` - Local development
- `helm/env/dev.values.yaml` - Development environment
- `helm/env/stage.values.yaml` - Staging environment  
- `helm/env/prod.values.yaml` - Production environment

## ğŸ”§ **Development**

### **Local Setup**
```bash
# Install dependencies
pip install -r src/requirements.txt

# Run in development mode
python src/app.py --infrastructure-mode --debug

# Run tests
pytest tests/
```

### **Docker Commands**
```bash
# Build
docker build -t infra-smoke-postgres .

# Run with volume persistence
docker run -v $(pwd)/data:/app/data -p 8545:8545 infra-smoke-postgres

# Check health
curl http://localhost:8545/health
```

## ğŸš¨ **Health Monitoring**

### **Health Check**
- **Endpoint**: `GET /health`
- **Interval**: 60 seconds
- **Timeout**: 30 seconds
- **Start Period**: 30 seconds
- **Retries**: 5

### **Readiness Check**
- **Endpoint**: `GET /ready`
- **Interval**: 10 seconds
- **Timeout**: 5 seconds

## ğŸ“‹ **Requirements**

- **CPU**: 500m (request) / 2000m (limit)
- **Memory**: 512Mi (request) / 2Gi (limit)
- **Storage**: 20Gi persistent volume
- **Network**: Access to required external services

## ğŸ”„ **Deployment Pipeline**

This service uses GitHub Actions for CI/CD:

1. **Code Push** â†’ Triggers build
2. **Docker Build** â†’ Creates container image
3. **Security Scan** â†’ Scans for vulnerabilities
4. **Deploy to Dev** â†’ Automatic deployment to dev environment
5. **Deploy to Prod** â†’ Manual approval for production

## ğŸ“ˆ **Monitoring & Alerts**

### **Key Metrics**
- Service availability
- Resource utilization (CPU/Memory)
- Disk usage for persistent storage
- Response time for health checks

### **Alerting**
- Health check failures
- Resource exhaustion
- Storage capacity warnings

## ğŸ¤ **Team Ownership**

- **Team**: team3
- **On-Call**: Check team rotation
- **Escalation**: Team lead for critical issues

## ğŸ“„ **License**

MIT License - use it however you want!

---

**ğŸŒŒ Infrastructure service for the Galaxy ecosystem - providing reliable foundational services.**