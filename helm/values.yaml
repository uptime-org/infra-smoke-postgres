# Default values for {{SERVICE_NAME}}
# This file contains shared values across all environments.
# Generated by GX Genesis - Infrastructure workload

# Service metadata
service:
  name: {{SERVICE_NAME}}
  description: {{DESCRIPTION}}
  tier: {{TIER}}
  workload: {{TIER}}
  team: {{TEAM}}
  version: "1.0.0"
  type: ClusterIP
  port: 5432
  targetPort: 5432
  annotations: {}

# DNS configuration  
dns:
  domains:
{{DNS_DOMAINS}}

# Global configurations
global:
  imageRegistry: "ghcr.io"
  imagePullSecrets: []
  ecoName: "{{ECO_NAME}}"
  namespace: "{{ECO_NAME}}"
  # Domains come from service configuration
  domains:
{{DNS_DOMAINS}}

# Image configuration
image:
  repository: ghcr.io/uptime-org/{{SERVICE_NAME}}
  pullPolicy: IfNotPresent
  tag: "latest"

# Replica configuration - Infrastructure services often need fewer replicas
replicaCount: 1

# Service account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod security context
podSecurityContext:
  fsGroup: 2000
  runAsNonRoot: true
  runAsUser: 2000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 2000

# Resource configuration - Infrastructure services need more resources
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

# Autoscaling configuration - Usually disabled for infrastructure
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 70

# Node selection - Infrastructure services may need specific nodes
nodeSelector: {}
tolerations: []
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - {{SERVICE_NAME}}
        topologyKey: kubernetes.io/hostname

# Pod disruption budget - More conservative for infrastructure
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Probes configuration - Adjusted for infrastructure workloads
probes:
  liveness:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 60  # Longer startup time for infrastructure
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readiness:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Standard Ingress configuration (populated by environment files)
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  hosts: []
  tls: []

# Gateway API configuration
gatewayApi:
  enabled: false
  gatewayName: "default-gateway"  # Reference to existing gateway
  
# Istio service mesh configuration
istio:
  enabled: false
  virtualService:
    enabled: false
    gatewayName: "default-gateway"  # Reference to existing gateway
  destinationRule:
    enabled: false
    trafficPolicy:
      loadBalancer:
        simple: LEAST_CONN

# Persistent storage for infrastructure services
persistence:
  enabled: true
  storageClassName: ""
  accessMode: ReadWriteOnce
  size: 20Gi
  annotations: {}

# Infrastructure-specific configurations
infrastructure:
  # Infrastructure service type (postgres, redis, mongodb, etc.)
  type: postgres
  # PostgreSQL specific configuration
  postgres:
    user: postgres
    database: {{SERVICE_NAME}}
  # Data directory for blockchain/validator data
  dataDir: "/app/data"
  # Config directory
  configDir: "/app/config"
  # Log level
  logLevel: "info"

# Galaxy sidecar configuration for unmanaged infrastructure
galaxy:
  sidecar:
    enabled: true
    image:
      repository: ghcr.io/uptime-org/{{SERVICE_NAME}}-sidecar
      pullPolicy: IfNotPresent
      tag: "latest"
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

# Base dependency configuration - templated URLs work for dev/stage/prod
# Only local infra services need override for east-west discovery
dependencies: []
# Template will populate with dependency structures based on config

# Environment-specific overrides placeholder
environment: {}

# Secrets configuration
secrets:
  enabled: false

# Network policies for service isolation and security
networkPolicy:
  enabled: true
  allowExternalEgress: true  # Allow internet for package installs
  # Auto-populated from services that depend on this infrastructure
  allowIngressFrom: []

# Labels and annotations
labels:
  # Ecosystem branding
  app.{{ECO_NAME}}.io/name: "{{SERVICE_NAME}}"
  app.{{ECO_NAME}}.io/tier: "{{TIER}}"
  app.{{ECO_NAME}}.io/team: "{{TEAM}}"
  # Galaxy tooling management
  galaxy.io/managed-by: "galaxy"
  galaxy.io/version: "1.0.0"
annotations:
  # Galaxy tooling metadata
  galaxy.io/generated-by: "gx-genesis"
  galaxy.io/template-version: "1.0.0"
